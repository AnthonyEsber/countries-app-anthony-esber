<html>
<head> </head>
<body>
    <script>
    (() => {
        const body = document.querySelector('body');
        const heading = document.createElement("h1");
        const searchDiv = document.createElement("div");
        const searchBar = '<label  for="country"><input style="padding-lefts: 20px; width: 90%; margin-right: 10px; height: 35px; border: 1px solid #eaeaea; border-radius: 16px" id="searchBar" name="countryInput" type="text"/></label>'
        const searchButton = '<button style="width: 9%; font-weight: bold;color: white; background-color: #7b7bff; height: 35px; border: 1px solid #eaeaea; border-radius: 8px" id="searchButton">Search</button>'
        const headingText = document.createTextNode("Country Search");
        const mainColorText = "#2a2a2a"
        const textLabel = document.createElement("p")
        const noCountryFound = 'No country found!'
        const resultsDiv = document.createElement("div")

        body.style.cssText = "background-color: #fbfbfb; font-family: sans-serif; text-align: center";
        heading.style.cssText = `color: ${mainColorText}`
        searchDiv.style.cssText =  `width: 55%; margin:auto;`
   
        
        heading.appendChild(headingText);
        body.append(heading, searchDiv);

        
        searchDiv.insertAdjacentHTML('beforeEnd', searchBar);
        

        const label = document.querySelector('label');


        label.insertAdjacentHTML('beforeEnd', searchButton);
        body.appendChild(resultsDiv)


        let countries = []

        const load = fetch('https://restcountries.com/v3.1/independent')
        .then(response => response.json()
        .then(data => {
            countries = data;
            data.forEach(country => {
                    resultsDiv.appendChild(createCountryDiv(country))
                });
        }));
    
        

        async function  searchCountry(input) {


            load.then( () => {
            const res = countries.filter(country => country.name.common.toLowerCase().startsWith(input.toLowerCase()))
            renderCountries(res);
        });
        }

        const sButton = document.getElementById("searchButton");
        const sBar = document.getElementById("searchBar");

        sButton.addEventListener("click", () => {
            searchCountry(sBar.value)
        })


        function createCountryDiv(country) {
            const card = document.createElement("div");
            const flagSection = document.createElement("div");
            const administrativeDetails = document.createElement("div")
            const otherDetails = document.createElement("div")

            card.className = "countries-card"
            flagSection.className  = "countries-flag"
            administrativeDetails.className = "countries-administrative"
            otherDetails.className = "countries-others"

            const countryTitle = document.createElement("h3");
            countryTitle.textContent = country.name.common
            
            const capital = document.createElement ("p");
            capital.textContent = `Capital: ${country.capital.join(', \n') || 'N/A'}`;

            const languages = document.createElement("p");
            languages.textContent = `Language: ${Object.values(country.languages).join(', \n') || 'N/A'}`
            
            const map = document.createElement("p")
            const link = `<a href=${country.maps.googleMaps}>Google Maps</a>`;
            map.textContent = `Map: `
            map.insertAdjacentHTML("beforeend", link);

            const population = document.createElement("p");
            population.textContent = `Population: ${country.population.toLocaleString()}`

            const currency = document.createElement("p")
            currency.textContent = `Currency: ${Object.values(country.currencies).map(c => c.name).join(", ") || 'N/A'}`

            const flag = document.createElement("img");
            flag.src = country.flags.png;

            flagSection.append(flag);
            administrativeDetails.append(countryTitle, capital, languages, map);
            otherDetails.append(population, currency);


            card.style.cssText = "display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: 1fr; max-width: 55%; margin: auto; align-items: center; background-color: white; margin-bottom: 10px; margin-top: 10px; border: 1px solid #eaeaea; border-radius: 16px"
            flag.style.cssText = "border-radius: 10px; grid-area: 1 / 1 / 2 / 2; width: 120px"
            administrativeDetails.style.cssText = "grid-area: 1 / 2 / 2 / 3; text-align: left"
            otherDetails.style.cssText = "grid-area: 1 / 3 / 2 / 4; text-align: left"

            card.append(flagSection, administrativeDetails, otherDetails);





            return card;
        }



        function renderCountries(list) {
            resultsDiv.innerHTML = ''
            if(list.length == 0){
                textLabel.textContent = noCountryFound;
                body.appendChild(textLabel)
                return
            } else {
                list.forEach(country => {
                    resultsDiv.appendChild(createCountryDiv(country))
                });
            }
        }
        



        
    })();
    </script>
</body>
</html>
